import{_ as I,p as A,E as _,A as g,a as E}from"./index.7f3d917a.js";import"vue";const B={components:{Plus:A},props:["authorId"],data(){return{albumsB:[],albums:[],albumsA:[],originalImg:[],simplifyImg:[],progress:{percentage:0,show:!1,status:""},albumName:"",fileList:[],previewDialog:!1,dialogImageUrl:"",uploadDialog:!1,editAlbumDialog:!1,rules:{albumName:{required:!0,message:"\u8BF7\u8F93\u5165\u76F8\u518C\u540D",trigger:"blur"}},OKFlag:!0}},methods:{previewImage(t){this.dialogImageUrl=this.originalImg[t],this.previewDialog=!0},handleRemove(t,e){},handlePictureCardPreview(t){this.dialogImageUrl=t.url,this.previewDialog=!0},dealImage(t,e){var l=new Image,r=.8;l.src=t,l.setAttribute("crossOrigin","Anonymous");var a,o;return new Promise(i=>{l.onload=function(){a=this.width,o=this.height;var s=document.createElement("canvas"),d=s.getContext("2d");let c=3200*(e/1e3);Math.max(a,o)>c?a>o?(s.width=c,s.height=c*o/a):(s.height=c,s.width=c*a/o):(s.width=a,s.height=o,r=1),d.clearRect(0,0,s.width,s.height),d.drawImage(this,0,0,s.width,s.height);var p=s.toDataURL("image/webp",r);let h=p.length*.75/1024;for(;h>e;)r-=.1,p=s.toDataURL("image/webp",r),h=p.length*.75/1024;i(p)}})},uploadHandler(){this.progress.unit=Math.round(1/this.fileList.length*100)},exceedHandler(){_({showClose:!0,message:"\u56FE\u7247\u6570\u91CF\u8D85\u51FA\u9650\u5236",type:"warning"})},async upload(){if(this.albumName==""){_({showClose:!0,message:"\u8BF7\u9009\u62E9\u76F8\u518C",type:"warning"});return}this.progress.status="",this.progress.show=!0,this.progress.percentage=0;for(let t of this.fileList)t.status=="ready"&&(t.status="uploading",t.percentage=0,await this.uploadFunc(t))},async uploadFunc(t){return new Promise(e=>{let l={albumName:this.albumName,originalImg:"",simplifyImg:""};new Date().getTime();var r=new FileReader;r.readAsDataURL(t.raw),r.onload=async a=>{new Date().getTime(),l.originalImg=await this.dealImage(a.target.result,1e3),l.simplifyImg=await this.dealImage(l.originalImg,200),g.post("image/add",l,o=>{t.percentage=o.loaded/o.total*100|0}).then(o=>{o.code==200?(t.status="success",this.progress.percentage+this.progress.unit>95?(this.progress.percentage=100,this.progress.status="success"):this.progress.percentage+=this.progress.unit):(t.status="ready",this.progress.status="warning")}).catch(o=>{t.status="ready",this.progress.status="exception"}),e()}})},clearAll(){this.fileList=[]},clearUpload(){let t=this.fileList.length;for(let e=0;e<t;e++)this.fileList[e].status=="success"&&(this.fileList.splice(e,1),e--,t--)},closeUpload(){this.uploadDialog=!1,this.progress.show=!1,this.progress.status="",this.progress.percentage=0},saveEditAlbum(){let t=[];this.albumsA.forEach(e=>{let l={};l.id=e.id,l.author="",l.albumName=e.albumName,e.imgChange?l.coverImg=e.coverImg:l.coverImg="",t.push(l)}),this.OKFlag=!0,this.$refs.albumRef.forEach(e=>{e.validate(l=>{l||(this.OKFlag=!1)})}),setTimeout(()=>{this.OKFlag&&g.post("album/update",t).then(e=>{e.code==200&&(_({showClose:!0,message:"\u7F16\u8F91\u6210\u529F",type:"success"}),console.log(e.data),this.editAlbumDialog=!1,this.albums=this.albumsA)})},100)},closeEditAlbum(){this.editAlbumDialog=!1},editAlbumUploadHandler(t,e){let l=new FileReader;l.readAsDataURL(t.file),l.onload=async r=>{this.albumsA[e].coverImg=await this.dealImage(r.target.result,200),this.albumsA[e].imgChange=!0}},editAlbumHandleExceed(t,e){this.$refs.editAlbumUploadRef[e].clearFiles(),this.$refs.editAlbumUploadRef[e].handleStart(t[0]);let l=new FileReader;l.readAsDataURL(t[0]),l.onload=async r=>{this.albumsA[e].coverImg=await this.dealImage(r.target.result,200)}},deleteAlbum(t){E.confirm("\u786E\u8BA4\u5220\u9664?","\u63D0\u793A\u6846",{distinguishCancelAndClose:!0,confirmButtonText:"\u662F",cancelButtonText:"\u5426",type:"warning",customStyle:{top:"-20% !important",position:"relative"}}).then(()=>{this.albumsA.splice(t,1)}).catch(e=>{})},addAlbum(){let t={id:-1,authorId:0,albumName:"\u65B0\u589E\u5206\u7C7B",coverImg:""};this.albumsA.push(t)},albumDialogOpen(){this.albumsA=[],this.albums.forEach(t=>{t.imgChange=!1,this.albumsA.push(JSON.parse(JSON.stringify(t)))})}},computed:{showFlag(){return!!(this.$store.state.isLogin&&this.authorId==this.$store.state.author.username)}},watch:{},mounted(){let t={authorId:this.authorId};g.get("init/getAlbums",t).then(e=>{e.code==200&&(e.data.forEach(l=>{l.coverImg=this.baseUrl+l.coverImg,l.albumName!="\u5168\u90E8"&&this.albumsB.push(l.albumName),this.albums.push(l)}),this.$store.commit("setAlbums",e.data))}),t={authorId:this.authorId,startPage:0,pageSize:8},g.get("init/getImages",t).then(e=>{e.code==200&&e.data.forEach(l=>{this.originalImg.push(this.baseUrl+l.originalImg),this.simplifyImg.push(this.baseUrl+l.simplifyImg)})})}},V=t=>(Vue.pushScopeId("data-v-c41b6c1b"),t=t(),Vue.popScopeId(),t),D={style:{margin:"0 0 1% 2.5%",height:"30px",opacity:"0.7"}},U={style:{margin:"0 2.5% 1% 0",height:"30px",opacity:"0.7"}},F=V(()=>Vue.createElementVNode("span",{class:"fenlei"},"\u5206\u7C7B",-1)),L=V(()=>Vue.createElementVNode("hr",{class:"line",align:"center"},null,-1)),R={class:"jutifenlei"},T=V(()=>Vue.createElementVNode("hr",{width:"100%",align:"left"},null,-1)),O=V(()=>Vue.createElementVNode("span",null,"\u7CBE\u9009",-1)),P=V(()=>Vue.createElementVNode("hr",{width:"100%",align:"right"},null,-1)),S={style:{"margin-left":"2%"}},H={style:{margin:"2% 0 0 2%"}},q={style:{display:"inline-block","margin-left":"2%","max-width":"150px"}},M={style:{"margin-top":"2%"}},j={style:{width:"200px","margin-top":"10px"}},z={style:{display:"inline-block",width:"150px","margin-top":"10px"}},K={style:{display:"inline-block",width:"100px","margin-top":"10px","vertical-align":"top"}},J={style:{margin:"2% 0 0 2%"}},W={class:"previewbox"},X=["src"];function G(t,e,l,r,a,o){const i=Vue.resolveComponent("el-col"),s=Vue.resolveComponent("el-button"),d=Vue.resolveComponent("el-row"),c=Vue.resolveComponent("el-image"),p=Vue.resolveComponent("router-link"),h=Vue.resolveComponent("Plus"),w=Vue.resolveComponent("el-icon"),b=Vue.resolveComponent("el-upload"),N=Vue.resolveComponent("el-option"),v=Vue.resolveComponent("el-select"),C=Vue.resolveComponent("el-progress"),f=Vue.resolveComponent("el-dialog"),y=Vue.resolveComponent("el-input"),x=Vue.resolveComponent("el-form-item"),k=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(d,{style:{"margin-top":"60px"}},{default:Vue.withCtx(()=>[Vue.createVNode(i,{class:"space"}),Vue.createVNode(i,{class:"container"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{style:{display:"flex","justify-content":"space-between"}},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",D,[o.showFlag?(Vue.openBlock(),Vue.createBlock(s,{key:0,type:"primary",onClick:e[0]||(e[0]=u=>a.uploadDialog=!0)},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4E0A\u4F20")]),_:1})):Vue.createCommentVNode("",!0)]),Vue.createElementVNode("div",U,[o.showFlag?(Vue.openBlock(),Vue.createBlock(s,{key:0,type:"warning",onClick:e[1]||(e[1]=u=>a.editAlbumDialog=!0)},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u7BA1\u7406\u76F8\u518C")]),_:1})):Vue.createCommentVNode("",!0)])]),_:1}),Vue.createVNode(d,{class:"header"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.albums,u=>(Vue.openBlock(),Vue.createBlock(p,{to:"/AlbumDetail/"+l.authorId+"_"+u.albumName,class:"item",key:u.id},{default:Vue.withCtx(()=>[Vue.createVNode(c,{fit:"cover",class:"cover",src:u.coverImg,lazy:""},null,8,["src"]),F,L,Vue.createElementVNode("span",R,Vue.toDisplayString(u.albumName),1)]),_:2},1032,["to"]))),128))]),_:1}),Vue.createVNode(d,{class:"fengexian"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{span:1}),Vue.createVNode(i,{span:10},{default:Vue.withCtx(()=>[T]),_:1}),Vue.createVNode(i,{span:2,style:{color:"deeppink"}},{default:Vue.withCtx(()=>[O]),_:1}),Vue.createVNode(i,{span:10},{default:Vue.withCtx(()=>[P]),_:1}),Vue.createVNode(i,{span:1})]),_:1}),Vue.createVNode(d,{class:"body"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.simplifyImg,(u,n)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"item",key:n},[Vue.createVNode(c,{class:"photo",src:u,fit:"cover",onClick:m=>o.previewImage(n)},null,8,["src","onClick"])]))),128))]),_:1})]),_:1}),Vue.createVNode(i,{class:"space"})]),_:1}),Vue.createVNode(f,{modelValue:a.uploadDialog,"onUpdate:modelValue":e[4]||(e[4]=u=>a.uploadDialog=u),top:"60px",width:"64%",style:{"min-width":"820px","border-radius":"20px"},"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",S,[Vue.createVNode(b,{"file-list":a.fileList,"onUpdate:file-list":e[2]||(e[2]=u=>a.fileList=u),ref:"uploadRef","list-type":"picture-card","on-preview":o.handlePictureCardPreview,"on-remove":o.handleRemove,"http-request":o.uploadHandler,"on-exceed":o.exceedHandler,multiple:"",limit:50,accept:".png, .jpg"},{default:Vue.withCtx(()=>[Vue.createVNode(w,null,{default:Vue.withCtx(()=>[Vue.createVNode(h)]),_:1})]),_:1},8,["file-list","on-preview","on-remove","http-request","on-exceed"])]),Vue.createElementVNode("div",H,[Vue.createVNode(s,{type:"primary",onClick:o.upload},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4E0A\u4F20")]),_:1},8,["onClick"]),Vue.createVNode(s,{type:"primary",onClick:o.clearAll},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u6E05\u7A7A\u5168\u90E8")]),_:1},8,["onClick"]),Vue.createVNode(s,{type:"primary",onClick:o.clearUpload},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u6E05\u7A7A\u5DF2\u4E0A\u4F20")]),_:1},8,["onClick"]),Vue.createVNode(s,{type:"danger",onClick:o.closeUpload},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),Vue.createElementVNode("div",q,[Vue.createVNode(v,{modelValue:a.albumName,"onUpdate:modelValue":e[3]||(e[3]=u=>a.albumName=u),placeholder:"\u9009\u62E9\u76F8\u518C"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.albumsB,(u,n)=>(Vue.openBlock(),Vue.createBlock(N,{key:n,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),Vue.createElementVNode("div",M,[Vue.withDirectives(Vue.createVNode(C,{percentage:a.progress.percentage,status:a.progress.status},null,8,["percentage","status"]),[[Vue.vShow,a.progress.show]])])])]),_:1},8,["modelValue"]),Vue.createVNode(f,{modelValue:a.editAlbumDialog,"onUpdate:modelValue":e[5]||(e[5]=u=>a.editAlbumDialog=u),top:"60px",width:"50%",style:{"min-width":"500px","border-radius":"20px"},"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,onOpen:o.albumDialogOpen},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(a.albumsA,(u,n)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"albumItem",key:n},[Vue.createVNode(d,null,{default:Vue.withCtx(()=>[Vue.createVNode(i,{class:"albumCover"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{class:"albumCoverImg",fit:"cover",src:u.coverImg,alt:"",lazy:""},null,8,["src"])]),_:2},1024),Vue.createVNode(i,{class:"albumInfo"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",j,[Vue.createVNode(k,{ref_for:!0,ref:"albumRef",model:a.albumsA[n],rules:a.rules},{default:Vue.withCtx(()=>[Vue.createVNode(x,{label:"\u76F8\u518C\u540D",prop:"albumName"},{default:Vue.withCtx(()=>[Vue.createVNode(y,{modelValue:a.albumsA[n].albumName,"onUpdate:modelValue":m=>a.albumsA[n].albumName=m,placeholder:"",disabled:u.albumName=="\u5168\u90E8"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1032,["model","rules"])]),Vue.createElementVNode("div",z,[Vue.createVNode(b,{ref_for:!0,ref:"editAlbumUploadRef",class:"upload-demo",accept:".png, .jpg","http-request":m=>{o.editAlbumUploadHandler(m,n)},limit:1,"on-exceed":m=>{o.editAlbumHandleExceed(m,n)}},{trigger:Vue.withCtx(()=>[Vue.createVNode(s,{type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u9009\u62E9\u5C01\u9762")]),_:1})]),_:2},1032,["http-request","on-exceed"])]),Vue.createElementVNode("div",K,[Vue.createVNode(s,{type:"danger",onClick:m=>o.deleteAlbum(n),disabled:u.albumName=="\u5168\u90E8"},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5220\u9664 ")]),_:2},1032,["onClick","disabled"])])]),_:2},1024)]),_:2},1024)]))),128)),Vue.createElementVNode("div",J,[Vue.createVNode(s,{type:"primary",onClick:o.saveEditAlbum},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4FDD\u5B58")]),_:1},8,["onClick"]),Vue.createVNode(s,{type:"danger",onClick:o.closeEditAlbum},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"]),Vue.createVNode(s,{type:"warning",onClick:o.addAlbum},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u65B0\u589E\u76F8\u518C")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onOpen"]),Vue.createVNode(f,{modelValue:a.previewDialog,"onUpdate:modelValue":e[6]||(e[6]=u=>a.previewDialog=u),width:"70%",top:"60px","append-to-body":!0,style:{"background-color":"aliceblue"}},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",W,[Vue.createElementVNode("img",{class:"img",src:a.dialogImageUrl,alt:""},null,8,X)])]),_:1},8,["modelValue"])])}const Z=I(B,[["render",G],["__scopeId","data-v-c41b6c1b"]]);export{Z as default};
