import{_ as H,bz as j,E as C,A as y,a as q,b as M,r as D,d as T,aq as K,an as z,ao as J,ap as W,o as g,e as _,f as l,w as i,g as u,h as w,i as h,j as U,F as I,k as A,t as G,l as Q,v as X,p as Y,m as Z}from"./index.f39f917a.js";import{b as $,E as ee,a as le,c as te}from"./el-select.bdc4dbf5.js";import"./el-tag.66f612cb.js";/* empty css                */import{a as ae,b as se,E as ie}from"./el-image-viewer.041a35b8.js";const k={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0}.VITE_BASE_URL,oe={components:{Plus:j},props:["authorId"],data(){return{baseUrl:k,albumsB:[],albums:[],albumsA:[],originalImg:[],simplifyImg:[],progress:{percentage:0,show:!1,status:""},albumName:"",fileList:[],dialogImageUrl:"",uploadDialog:!1,previewDialog:!1,editAlbumDialog:!1,rules:{albumName:{required:!0,message:"\u8BF7\u8F93\u5165\u76F8\u518C\u540D",trigger:"blur"}},OKFlag:!0}},methods:{handleRemove(a,e){},handlePictureCardPreview(a){this.dialogImageUrl=a.url,this.previewDialog=!0},dealImage(a){var e=new Image,s=.9;e.src=a,e.setAttribute("crossOrigin","Anonymous");var d,t;return new Promise(n=>{e.onload=async function(){d=this.width,t=this.height;var r=document.createElement("canvas"),m=r.getContext("2d");let c=1920;Math.max(d,t)>c?d>t?(r.width=c,r.height=c*t/d):(r.height=c,r.width=c*d/t):(r.width=d,r.height=t,s=1),m.clearRect(0,0,r.width,r.height),m.drawImage(this,0,0,r.width,r.height);for(var f=r.toDataURL("image/jpeg",s);f.length/1024>1e3;)s-=.05,f=r.toDataURL("image/jpeg",s);n(f)}})},uploadHandler(){},exceedHandler(){C({showClose:!0,message:"\u56FE\u7247\u6570\u91CF\u8D85\u51FA\u9650\u5236",type:"warning"})},upload(){if(this.albumName==""){C({showClose:!0,message:"\u8BF7\u9009\u62E9\u76F8\u518C",type:"warning"});return}this.progress.show=!0,this.progress.percentage=0;let a=Math.round(1/this.fileList.length*100);this.fileList.forEach(e=>{if(e.status=="ready"){e.status="uploading",e.percentage=Math.round(20*Math.random());let s={albumName:this.albumName,originalImg:"",simplifyImg:""},d=new FileReader;d.readAsDataURL(e.raw),d.onload=async t=>{s.originalImg=t.target.result,s.simplifyImg=await this.dealImage(t.target.result),y.post("image/add",s).then(n=>{n.code==200?(e.status="success",this.progress.percentage+a>95?(this.progress.percentage=100,this.progress.status="success"):this.progress.percentage+=a):(e.status="fail",this.progress.status="warning")}).catch(n=>{e.status="fail",this.progress.status="exception"})}}})},clearAll(){this.fileList=[]},clearUpload(){let a=this.fileList.length;for(let e=0;e<a;e++)this.fileList[e].status=="success"&&(this.fileList.splice(e,1),e--,a--)},closeUpload(){this.uploadDialog=!1,this.progress.show=!1,this.progress.status="",this.progress.percentage=0},saveEditAlbum(){let a=[];this.albumsA.forEach(e=>{let s={};s.id=e.id,s.author="",s.albumName=e.albumName,e.imgChange?s.coverImg=e.coverImg:s.coverImg="",a.push(s)}),this.OKFlag=!0,this.$refs.albumRef.forEach(e=>{e.validate(s=>{s||(this.OKFlag=!1)})}),setTimeout(()=>{this.OKFlag&&y.post("album/update",a).then(e=>{e.code==200&&(C({showClose:!0,message:"\u7F16\u8F91\u6210\u529F",type:"success"}),console.log(e.data),this.editAlbumDialog=!1,this.albums=this.albumsA)})},100)},closeEditAlbum(){this.editAlbumDialog=!1},editAlbumUploadHandler(a,e){let s=new FileReader;s.readAsDataURL(a.file),s.onload=async d=>{this.albumsA[e].coverImg=await this.dealImage(d.target.result),this.albumsA[e].imgChange=!0}},editAlbumHandleExceed(a,e){this.$refs.editAlbumUploadRef[e].clearFiles(),this.$refs.editAlbumUploadRef[e].handleStart(a[0]);let s=new FileReader;s.readAsDataURL(a[0]),s.onload=async d=>{this.albumsA[e].coverImg=await this.dealImage(d.target.result)}},deleteAlbum(a){q.confirm("\u786E\u8BA4\u5220\u9664?","\u63D0\u793A\u6846",{distinguishCancelAndClose:!0,confirmButtonText:"\u662F",cancelButtonText:"\u5426",type:"warning",customStyle:{top:"-20% !important",position:"relative"}}).then(()=>{this.albumsA.splice(a,1)}).catch(e=>{})},addAlbum(){let a={id:-1,authorId:0,albumName:"\u65B0\u589E\u5206\u7C7B",coverImg:""};this.albumsA.push(a)},albumDialogOpen(){this.albumsA=[],this.albums.forEach(a=>{a.imgChange=!1,this.albumsA.push(JSON.parse(JSON.stringify(a)))})}},computed:{showFlag(){return!!(this.$store.state.isLogin&&this.authorId==this.$store.state.author.username)}},watch:{},mounted(){let a={authorId:this.authorId};y.get("init/getAlbums",a).then(e=>{e.code==200&&(e.data.forEach(s=>{s.coverImg=k+s.coverImg,s.albumName!="\u5168\u90E8"&&this.albumsB.push(s.albumName),this.albums.push(s)}),this.$store.commit("setAlbums",e.data))}),a={authorId:this.authorId,startPage:0,pageSize:8},y.get("init/getImages",a).then(e=>{e.code==200&&e.data.forEach(s=>{this.originalImg.push(k+s.originalImg),this.simplifyImg.push(k+s.simplifyImg)})})}},v=a=>(Y("data-v-a8c3a62b"),a=a(),Z(),a),re={style:{margin:"0 0 1% 2.5%",height:"30px",opacity:"0.7"}},ne={style:{margin:"0 2.5% 1% 0",height:"30px",opacity:"0.7"}},ue=v(()=>u("span",{class:"fenlei"},"\u5206\u7C7B",-1)),de=v(()=>u("hr",{class:"line",align:"center"},null,-1)),me={class:"jutifenlei"},ce=v(()=>u("hr",{width:"100%",align:"left"},null,-1)),pe=v(()=>u("span",null,"\u7CBE\u9009",-1)),ge=v(()=>u("hr",{width:"100%",align:"right"},null,-1)),he={style:{"margin-left":"2%"}},fe={style:{margin:"2% 0 0 2%"}},_e={style:{display:"inline-block","margin-left":"2%","max-width":"150px"}},be={style:{"margin-top":"2%"}},ve={class:"previewDialog"},ye={style:{width:"200px","margin-top":"10px"}},we={style:{display:"inline-block",width:"150px","margin-top":"10px"}},Ie={style:{display:"inline-block",width:"100px","margin-top":"10px","vertical-align":"top"}},Ae={style:{margin:"2% 0 0 2%"}};function ke(a,e,s,d,t,n){const r=ae,m=M,c=se,f=ie,N=D("router-link"),V=D("Plus"),R=T,x=$,L=ee,F=le,O=te,E=K,B=z,S=J,P=W;return g(),_("div",null,[l(c,{style:{"margin-top":"60px"}},{default:i(()=>[l(r,{class:"space"}),l(r,{class:"container"},{default:i(()=>[l(c,{style:{display:"flex","justify-content":"space-between"}},{default:i(()=>[u("div",re,[n.showFlag?(g(),w(m,{key:0,type:"primary",onClick:e[0]||(e[0]=o=>t.uploadDialog=!0)},{default:i(()=>[h("\u4E0A\u4F20")]),_:1})):U("",!0)]),u("div",ne,[n.showFlag?(g(),w(m,{key:0,type:"warning",onClick:e[1]||(e[1]=o=>t.editAlbumDialog=!0)},{default:i(()=>[h("\u7BA1\u7406\u76F8\u518C")]),_:1})):U("",!0)])]),_:1}),l(c,{class:"header"},{default:i(()=>[(g(!0),_(I,null,A(t.albums,o=>(g(),w(N,{to:"/AlbumDetail/"+s.authorId+"_"+o.albumName,class:"item",key:o.id},{default:i(()=>[l(f,{fit:"cover",class:"cover",src:o.coverImg},null,8,["src"]),ue,de,u("span",me,G(o.albumName),1)]),_:2},1032,["to"]))),128))]),_:1}),l(c,{class:"fengexian"},{default:i(()=>[l(r,{span:1}),l(r,{span:10},{default:i(()=>[ce]),_:1}),l(r,{span:2,style:{color:"deeppink"}},{default:i(()=>[pe]),_:1}),l(r,{span:10},{default:i(()=>[ge]),_:1}),l(r,{span:1})]),_:1}),l(c,{class:"body"},{default:i(()=>[(g(!0),_(I,null,A(t.simplifyImg,(o,p)=>(g(),_("div",{class:"item",key:p},[l(f,{class:"photo",src:o,"preview-src-list":t.originalImg,fit:"cover","initial-index":p,"preview-teleported":!0,"hide-on-click-modal":!0},null,8,["src","preview-src-list","initial-index"])]))),128))]),_:1})]),_:1}),l(r,{class:"space"})]),_:1}),l(E,{modelValue:t.uploadDialog,"onUpdate:modelValue":e[5]||(e[5]=o=>t.uploadDialog=o),top:"60px",width:"64%",style:{"min-width":"820px","border-radius":"20px"},"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0},{default:i(()=>[u("div",he,[l(x,{"file-list":t.fileList,"onUpdate:file-list":e[2]||(e[2]=o=>t.fileList=o),ref:"uploadRef","list-type":"picture-card","on-preview":n.handlePictureCardPreview,"on-remove":n.handleRemove,"http-request":n.uploadHandler,"on-exceed":n.exceedHandler,multiple:"",limit:50,accept:".png, .jpg"},{default:i(()=>[l(R,null,{default:i(()=>[l(V)]),_:1})]),_:1},8,["file-list","on-preview","on-remove","http-request","on-exceed"])]),u("div",fe,[l(m,{type:"primary",onClick:n.upload},{default:i(()=>[h("\u4E0A\u4F20")]),_:1},8,["onClick"]),l(m,{type:"primary",onClick:n.clearAll},{default:i(()=>[h("\u6E05\u7A7A\u5168\u90E8")]),_:1},8,["onClick"]),l(m,{type:"primary",onClick:n.clearUpload},{default:i(()=>[h("\u6E05\u7A7A\u5DF2\u4E0A\u4F20")]),_:1},8,["onClick"]),l(m,{type:"danger",onClick:n.closeUpload},{default:i(()=>[h("\u5173\u95ED")]),_:1},8,["onClick"]),u("div",_e,[l(F,{modelValue:t.albumName,"onUpdate:modelValue":e[3]||(e[3]=o=>t.albumName=o),placeholder:"\u9009\u62E9\u76F8\u518C"},{default:i(()=>[(g(!0),_(I,null,A(t.albumsB,(o,p)=>(g(),w(L,{key:p,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),u("div",be,[Q(l(O,{percentage:t.progress.percentage,status:t.progress.status},null,8,["percentage","status"]),[[X,t.progress.show]])])]),l(E,{modelValue:t.previewDialog,"onUpdate:modelValue":e[4]||(e[4]=o=>t.previewDialog=o),width:"70%",top:"60px",style:{"background-color":"transparent"}},{default:i(()=>[u("div",ve,[l(f,{fit:"cover",src:t.dialogImageUrl},null,8,["src"])])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(E,{modelValue:t.editAlbumDialog,"onUpdate:modelValue":e[6]||(e[6]=o=>t.editAlbumDialog=o),top:"60px",width:"50%",style:{"min-width":"500px","border-radius":"20px"},"close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,onOpen:n.albumDialogOpen},{default:i(()=>[(g(!0),_(I,null,A(t.albumsA,(o,p)=>(g(),_("div",{class:"albumItem",key:p},[l(c,null,{default:i(()=>[l(r,{class:"albumCover"},{default:i(()=>[l(f,{class:"albumCoverImg",fit:"cover",src:o.coverImg,alt:""},null,8,["src"])]),_:2},1024),l(r,{class:"albumInfo"},{default:i(()=>[u("div",ye,[l(P,{ref_for:!0,ref:"albumRef",model:t.albumsA[p],rules:t.rules},{default:i(()=>[l(S,{label:"\u76F8\u518C\u540D",prop:"albumName"},{default:i(()=>[l(B,{modelValue:t.albumsA[p].albumName,"onUpdate:modelValue":b=>t.albumsA[p].albumName=b,placeholder:"",disabled:o.albumName=="\u5168\u90E8"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1024)]),_:2},1032,["model","rules"])]),u("div",we,[l(x,{ref_for:!0,ref:"editAlbumUploadRef",class:"upload-demo",accept:".png, .jpg","http-request":b=>{n.editAlbumUploadHandler(b,p)},limit:1,"on-exceed":b=>{n.editAlbumHandleExceed(b,p)}},{trigger:i(()=>[l(m,{type:"primary"},{default:i(()=>[h("\u9009\u62E9\u5C01\u9762")]),_:1})]),_:2},1032,["http-request","on-exceed"])]),u("div",Ie,[l(m,{type:"danger",onClick:b=>n.deleteAlbum(p),disabled:o.albumName=="\u5168\u90E8"},{default:i(()=>[h("\u5220\u9664 ")]),_:2},1032,["onClick","disabled"])])]),_:2},1024)]),_:2},1024)]))),128)),u("div",Ae,[l(m,{type:"primary",onClick:n.saveEditAlbum},{default:i(()=>[h("\u4FDD\u5B58")]),_:1},8,["onClick"]),l(m,{type:"danger",onClick:n.closeEditAlbum},{default:i(()=>[h("\u5173\u95ED")]),_:1},8,["onClick"]),l(m,{type:"warning",onClick:n.addAlbum},{default:i(()=>[h("\u65B0\u589E\u76F8\u518C")]),_:1},8,["onClick"])])]),_:1},8,["modelValue","onOpen"])])}const Ne=H(oe,[["render",ke],["__scopeId","data-v-a8c3a62b"]]);export{Ne as default};
