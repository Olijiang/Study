import{_ as f,b as x,E as g,A as m}from"./index.7f3d917a.js";import{m as v}from"./markdown.fab8dcaa.js";import"vue";const k={components:{},props:{tags:Array,categories:Array,editFlag:x},data(){return{imgChange:!1,newCategory:"",newTag:"",rules:{title:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},category:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"blur"},tag:{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:"blur"}}}},methods:{test(){},dealImage(l){var e=new Image,o=.9;e.src=l,e.setAttribute("crossOrigin","Anonymous");var u,r;return new Promise(t=>{e.onload=async function(){u=this.width,r=this.height;var n=document.createElement("canvas"),s=n.getContext("2d");let V=1920;Math.max(u,r)>V?u>r?(n.width=V,n.height=V*r/u):(n.height=V,n.width=V*u/r):(n.width=u,n.height=r,o=1),s.clearRect(0,0,n.width,n.height),s.drawImage(this,0,0,n.width,n.height);for(var i=n.toDataURL("image/jpeg",o);i.length/1024>1e3;)o-=.05,i=n.toDataURL("image/jpeg",o);t(i)}})},uploadHandler(l){let e=new FileReader;e.readAsDataURL(l.file),e.onload=async o=>{this.article.img=await this.dealImage(o.target.result)},this.imgChange=!0},handleExceed(l){this.$refs.uploadRef.clearFiles(),this.$refs.uploadRef.handleStart(l[0]);let e=new FileReader;e.readAsDataURL(l[0]),e.onload=async o=>{this.article.img=await this.dealImage(o.target.result)}},addCategory(){console.log("add new category",this.newCategory),this.categories.push(this.newCategory),this.article.category=this.newCategory,this.newCategory=""},addTag(){console.log("add new tag",this.newTag),this.tags.push(this.newTag),this.article.tag.push(this.newTag),this.newTag=""},drapContent(l){let e=document.getElementsByClassName("input-body")[0],o=document.getElementsByClassName("markdown-body")[0],u=window.getComputedStyle(e).getPropertyValue("width"),r=window.getComputedStyle(o).getPropertyValue("width"),t=l.clientX;document.onmousemove=function(n){let s=n.clientX-t;u.slice(0,-2)>100&&r.slice(0,-2)>100&&(e.style.width=`calc(${u} + ${s}px)`,o.style.width=`calc(${r} - ${s}px)`)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},resetSize(){let l=document.getElementsByClassName("markdown")[0],e=document.getElementsByClassName("html")[0];l.style.width="50%",e.style.width="calc(50% - 20px)",document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},saveToScript(){},saveAndIssue(){this.$refs.articleRef.validate(l=>{if(l){if(this.article.img==""){g({showClose:!0,message:"\u8BF7\u9009\u62E9\u4E00\u5F20\u63D2\u56FE",type:"warning"});return}if(this.article.content==""){g({showClose:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"});return}if(this.editFlag){let e=this.article;this.imgChange||(e.img=""),console.log(e),m.post("article/update",e).then(o=>{o.code==200&&g({type:"success",message:"\u4FEE\u6539\u6210\u529F"})})}else m.post("article/add",this.article).then(e=>{e.code==200&&g({type:"success",message:"\u53D1\u8868\u6210\u529F"})});this.editDialog=!1}})},resetForm(){this.$refs.articleRef.resetFields()},closeAndSaveToScript(){this.editDialog=!1},closeHandler(){this.$refs.uploadRef.clearFiles(),setTimeout(()=>{this.resetForm()},100)}},computed:{htmlContent(){return v(this.article.content)},editDialog:{get(){return this.$store.state.editDialog},set(l){this.$store.state.editDialog=l}},article(){return this.$store.state.article}},watch:{},mounted(){}},E={class:"header"},b={class:"title"},T={class:"info"},B={style:{margin:"0 15px"}},D={style:{margin:"0 15px"}},A={style:{height:"150px",width:"250px",translate:"0 -30px"}},S={style:{margin:"10px 0"}},I={style:{margin:"10px 0"}},F={class:"content"},z={class:"input-body"},H=["innerHTML"];function q(l,e,o,u,r,t){const n=Vue.resolveComponent("el-input"),s=Vue.resolveComponent("el-form-item"),V=Vue.resolveComponent("el-option"),i=Vue.resolveComponent("el-select"),c=Vue.resolveComponent("el-col"),d=Vue.resolveComponent("el-button"),p=Vue.resolveComponent("el-upload"),y=Vue.resolveComponent("el-row"),C=Vue.resolveComponent("el-image"),w=Vue.resolveComponent("el-form"),N=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createBlock(N,{style:{"border-radius":"10px","z-index":"2","margin-bottom":"100px"},modelValue:t.editDialog,"onUpdate:modelValue":e[8]||(e[8]=a=>t.editDialog=a),top:"60px",width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:t.closeHandler,"append-to-body":!0},{default:Vue.withCtx(()=>[Vue.createVNode(w,{id:"myform",model:t.article,ref:"articleRef",rules:r.rules},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",E,[Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createVNode(c,{span:12},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",b,[Vue.createVNode(s,{prop:"title"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{style:{"font-size":"20px"},size:"large",modelValue:t.article.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.article.title=a),placeholder:"\u6807\u9898"},null,8,["modelValue"])]),_:1})]),Vue.createElementVNode("div",T,[Vue.createVNode(y,null,{default:Vue.withCtx(()=>[Vue.createVNode(c,{span:7},{default:Vue.withCtx(()=>[Vue.createVNode(s,{prop:"category"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:t.article.category,"onUpdate:modelValue":e[2]||(e[2]=a=>t.article.category=a),placeholder:"\u9009\u62E9\u5206\u7C7B"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.categories,(a,_)=>(Vue.openBlock(),Vue.createBlock(V,{key:_,label:a,value:a},null,8,["label","value"]))),128)),Vue.createElementVNode("div",B,[Vue.createVNode(n,{modelValue:r.newCategory,"onUpdate:modelValue":e[1]||(e[1]=a=>r.newCategory=a),placeholder:"\u65B0\u5EFA\u5206\u7C7B",type:"text",onKeyup:Vue.withKeys(t.addCategory,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),Vue.createVNode(c,{span:1}),Vue.createVNode(c,{span:7},{default:Vue.withCtx(()=>[Vue.createVNode(s,{prop:"tag"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:t.article.tag,"onUpdate:modelValue":e[4]||(e[4]=a=>t.article.tag=a),placeholder:"\u9009\u62E9\u6807\u7B7E","collapse-tags":"",multiple:!0,clearable:""},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(o.tags,(a,_)=>(Vue.openBlock(),Vue.createBlock(V,{key:_,label:a,value:a},null,8,["label","value"]))),128)),Vue.createElementVNode("div",D,[Vue.createVNode(n,{modelValue:r.newTag,"onUpdate:modelValue":e[3]||(e[3]=a=>r.newTag=a),placeholder:"\u65B0\u5EFA\u6807\u7B7E",type:"text",onKeyup:Vue.withKeys(t.addTag,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),Vue.createVNode(c,{span:1}),Vue.createVNode(c,{span:8},{default:Vue.withCtx(()=>[Vue.createVNode(p,{ref:"uploadRef",class:"upload-demo",name:"illustrate",accept:".png, .jpg","http-request":t.uploadHandler,limit:1,"on-exceed":t.handleExceed},{trigger:Vue.withCtx(()=>[Vue.createVNode(d,{type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u9009\u62E9\u63D2\u56FE")]),_:1})]),_:1},8,["http-request","on-exceed"])]),_:1})]),_:1})])]),_:1}),Vue.createVNode(c,{span:1}),Vue.createVNode(c,{span:6},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.Transition,{name:"el-zoom-in-top"},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",A,[Vue.createVNode(C,{class:"img",fit:"cover",src:t.article.img},null,8,["src"])])]),_:1})]),_:1}),Vue.createVNode(c,{span:4},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(d,{type:"primary",onClick:t.saveToScript},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"])]),Vue.createElementVNode("div",S,[Vue.createVNode(d,{type:"primary",onClick:t.saveAndIssue},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u53D1\u8868")]),_:1},8,["onClick"])]),Vue.createElementVNode("div",I,[Vue.createVNode(d,{type:"danger",onClick:t.closeAndSaveToScript},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),Vue.createElementVNode("div",F,[Vue.createElementVNode("div",z,[Vue.createVNode(n,{style:{"font-size":"16px",height:"100%"},type:"textarea",modelValue:t.article.content,"onUpdate:modelValue":e[5]||(e[5]=a=>t.article.content=a),resize:"none",placeholder:"\u6587\u7AE0\u5185\u5BB9"},null,8,["modelValue"])]),Vue.createElementVNode("div",{class:"resize",onMousedown:e[6]||(e[6]=(...a)=>t.drapContent&&t.drapContent(...a)),onDblclick:e[7]||(e[7]=(...a)=>t.resetSize&&t.resetSize(...a))},null,32),Vue.createElementVNode("div",{class:"markdown-body",innerHTML:t.htmlContent},null,8,H)])]),_:1},8,["model","rules"]),Vue.createVNode(d,{type:"primary",onClick:t.saveToScript},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"]),Vue.createVNode(d,{type:"primary",onClick:t.saveAndIssue},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u53D1\u8868")]),_:1},8,["onClick"]),Vue.createVNode(d,{type:"danger",onClick:t.closeAndSaveToScript},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5173\u95ED")]),_:1},8,["onClick"])]),_:1},8,["modelValue","onClose"])}const L=f(k,[["render",q],["__scopeId","data-v-bd2cf29c"]]);const R={components:{ArticleEditorVue:L},props:["authorId"],data(){return{editFlag:!1,query:"",articleList:[],queryData:{authorId:"",startPage:0,pageSize:10},categories:[],tags:[]}},methods:{queryHandler(){},addHandler(){this.$store.commit("clearArticle"),this.editDialog=!0,this.editFlag=!1},editHandler(l){let e={ArticleId:l};m.get("init/getArticle",e).then(o=>{o.code==200&&(o.data.img=this.baseUrl+o.data.img,this.$store.commit("setArticle",o.data),setTimeout(()=>{this.editFlag=!0,this.editDialog=!0},100))})},deleteHandler(l){},articleDeail(l){this.$router.push({path:"/ArticleDetail/"+l})}},computed:{editDialog:{get(){return this.$store.state.editDialog},set(l){this.$store.state.editDialog=l}},showFlag(){return!!(this.$store.state.isLogin&&this.authorId==this.$store.state.author.username)}},watch:{},mounted(){this.queryData.authorId=this.authorId,m.get("init/getArticles",this.queryData).then(e=>{e.data.forEach(o=>{o.tag=JSON.parse(o.tag).tags,o.digest=o.digest.replace(/#*.*#/g,"").replace(/[^a-z0-9\u4e00-\u9fa5]/,"").substring(0,200),this.articleList.push(o)})});let l={authorId:this.authorId};m.get("init/getTags",l).then(e=>{this.tags=e.data}),m.get("init/getCategories",l).then(e=>{this.categories=e.data})}},h=l=>(Vue.pushScopeId("data-v-78ff4fd6"),l=l(),Vue.popScopeId(),l),U={class:"body"},K={style:{display:"flex","justify-content":"space-between"}},M={style:{width:"200px",display:"inline-block",opacity:"0.5"}},P={style:{"margin-left":"20px",display:"inline-block",opacity:"0.5"}},j={key:0,style:{"margin-left":"20px",opacity:"0.7"}},X=["data-index"],W={class:"content"},O=["onClick"],J=h(()=>Vue.createElementVNode("span",null," \u65F6\u95F4:",-1)),G={style:{color:"#d63a3a","font-size":"90%"}},Q=h(()=>Vue.createElementVNode("span",null," \u5206\u7C7B:",-1)),Y={style:{color:"#d63a3a","font-size":"90%"}},Z=h(()=>Vue.createElementVNode("span",null," \u6807\u7B7E:",-1)),$=h(()=>Vue.createElementVNode("span",{style:{color:"#00c6a5"}},null,-1)),ee={style:{margin:"10px 0","text-indent":"2em","line-height":"20px"}},te={class:"but"},le={key:0,class:"buttom"},oe={key:1,class:"buttom"};function ae(l,e,o,u,r,t){const n=Vue.resolveComponent("el-input"),s=Vue.resolveComponent("el-button"),V=Vue.resolveComponent("ArticleEditorVue");return Vue.openBlock(),Vue.createElementBlock("div",U,[Vue.createElementVNode("div",K,[Vue.createElementVNode("div",null,[Vue.createElementVNode("div",M,[Vue.createVNode(n,{modelValue:r.query,"onUpdate:modelValue":e[0]||(e[0]=i=>r.query=i)},null,8,["modelValue"])]),Vue.createElementVNode("div",P,[Vue.createVNode(s,{color:"#626aef",onClick:t.queryHandler},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u67E5\u627E")]),_:1},8,["onClick"])])]),t.showFlag?(Vue.openBlock(),Vue.createElementBlock("div",j,[Vue.createVNode(s,{color:"#ffae19",onClick:t.addHandler},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5199\u6587\u7AE0")]),_:1},8,["onClick"])])):Vue.createCommentVNode("",!0)]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(r.articleList,(i,c)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:i.id,"data-index":c,class:"article"},[Vue.createElementVNode("div",W,[Vue.createElementVNode("div",null,[Vue.createElementVNode("span",{class:"title",onClick:d=>t.articleDeail(i.id)},Vue.toDisplayString(i.title)+" \xA0",9,O),J,Vue.createElementVNode("span",G,Vue.toDisplayString(i.createTime)+" \xA0",1),Q,Vue.createElementVNode("span",Y,Vue.toDisplayString(i.category)+" \xA0",1),Z,(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(i.tag,(d,p)=>(Vue.openBlock(),Vue.createElementBlock("span",{style:{color:"#d63a3a","font-size":"90%"},key:p},[Vue.createTextVNode(Vue.toDisplayString(d)+" ",1),$]))),128))]),Vue.createElementVNode("div",ee,Vue.toDisplayString(i.digest),1)]),Vue.createElementVNode("div",te,[t.showFlag?(Vue.openBlock(),Vue.createElementBlock("div",le,[Vue.createVNode(s,{type:"primary",onClick:d=>t.editHandler(i.id)},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u7F16\u8F91")]),_:2},1032,["onClick"])])):Vue.createCommentVNode("",!0),t.showFlag?(Vue.openBlock(),Vue.createElementBlock("div",oe,[Vue.createVNode(s,{type:"danger",onClick:d=>t.deleteHandler(i.id)},{default:Vue.withCtx(()=>[Vue.createTextVNode("\u5220\u9664")]),_:2},1032,["onClick"])])):Vue.createCommentVNode("",!0)])],8,X))),128)),Vue.createVNode(V,{categories:r.categories,tags:r.tags,editFlag:r.editFlag},null,8,["categories","tags","editFlag"])])}const se=f(R,[["render",ae],["__scopeId","data-v-78ff4fd6"]]);export{se as default};
