import{_ as S,a as F,E as w,A as f,b as N,c as R,r as z,o as u,d as A,w as a,e as l,f as s,g as _,h as k,F as b,i as I,j as p,T as K,k as H,l as j,m as L,n as M,p as P,q as E,t as v,s as X,u as O}from"./index.8ad34794.js";import{E as W,a as J,b as G}from"./el-select.f397a1f7.js";import"./el-tag.f224c1ec.js";import{m as Q}from"./markdown.fab8dcaa.js";const Y={components:{backToTopVue:F},props:{tags:Array,categories:Array},data(){return{newCategory:"",newTag:"",rules:{title:{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898",trigger:"blur"},category:{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",trigger:"blur"},tag:{required:!0,message:"\u8BF7\u9009\u62E9\u6807\u7B7E",trigger:"blur"}}}},methods:{test(){},uploadHandler(o){let e=o.file;console.log(e);let n=new FileReader;n.readAsDataURL(e),console.log(n),n.onload=y=>{this.article.img=y.target.result}},addCategory(){console.log("add new category",this.newCategory),this.categories.push(this.newCategory),this.article.category=this.newCategory,this.newCategory=""},addTag(){console.log("add new tag",this.newTag),this.tags.push(this.newTag),this.article.tag.push(this.newTag),this.newTag=""},drapContent(o){let e=document.getElementsByClassName("markdown-body")[0],n=document.getElementsByClassName("html")[0],y=window.getComputedStyle(e).getPropertyValue("width"),r=window.getComputedStyle(n).getPropertyValue("width"),t=o.clientX;document.onmousemove=function(h){let g=h.clientX-t;y.slice(0,-2)>100&&r.slice(0,-2)>100&&(e.style.width=`calc(${y} + ${g}px)`,n.style.width=`calc(${r} - ${g}px)`)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},resetSize(){let o=document.getElementsByClassName("markdown")[0],e=document.getElementsByClassName("html")[0];o.style.width="50%",e.style.width="calc(50% - 20px)",document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}},saveToScript(){},saveAndIssue(){this.$refs.articleRef.validate(o=>{if(o){if(this.article.img==""){w({showClose:!0,message:"\u8BF7\u9009\u62E9\u4E00\u5F20\u63D2\u56FE",type:"warning"});return}if(this.article.content==""){w({showClose:!0,message:"\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"});return}this.editFlag?f.post("article/update",this.article).then(e=>{e.code==200&&w({type:"success",message:"\u4FEE\u6539\u6210\u529F"})}):f.post("article/add",this.article).then(e=>{e.code==200&&w({type:"success",message:"\u53D1\u8868\u6210\u529F"})}),this.editDialog=!1}})},resetForm(){this.$refs.articleRef.resetFields()},closeAndSaveToScript(){this.editDialog=!1},closeHandler(){setTimeout(()=>{this.resetForm()},100)}},computed:{htmlContent(){return Q(this.article.content)},editDialog:{get(){return this.$store.state.editDialog},set(o){this.$store.state.editDialog=o}},article(){return this.$store.state.article}},watch:{},mounted(){}},Z={class:"header"},$={class:"title"},ee={class:"info"},te={style:{margin:"0 15px"}},le={style:{margin:"0 15px"}},ae={style:{height:"150px",width:"250px",translate:"0 -30px"}},se=["src"],oe={style:{margin:"10px 0"}},ie={style:{margin:"10px 0"}},ne={class:"content"},re={class:"input-body"},de=["innerHTML"];function ce(o,e,n,y,r,t){const h=H,g=N,C=W,d=J,m=j,c=L,V=G,D=M,q=R,U=z("backToTopVue"),B=P;return u(),A(B,{style:{"border-radius":"10px","z-index":"2","margin-bottom":"100px"},modelValue:t.editDialog,"onUpdate:modelValue":e[8]||(e[8]=i=>t.editDialog=i),top:"60px",width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:t.closeHandler,"append-to-body":!0},{default:a(()=>[l(q,{id:"myform",model:t.article,ref:"articleRef",rules:r.rules},{default:a(()=>[s("div",Z,[l(D,null,{default:a(()=>[l(m,{span:12},{default:a(()=>[s("div",$,[l(g,{prop:"title"},{default:a(()=>[l(h,{style:{"font-size":"20px"},size:"large",modelValue:t.article.title,"onUpdate:modelValue":e[0]||(e[0]=i=>t.article.title=i),placeholder:"\u6807\u9898"},null,8,["modelValue"])]),_:1})]),s("div",ee,[l(D,null,{default:a(()=>[l(m,{span:7},{default:a(()=>[l(g,{prop:"category"},{default:a(()=>[l(d,{modelValue:t.article.category,"onUpdate:modelValue":e[2]||(e[2]=i=>t.article.category=i),placeholder:"\u9009\u62E9\u5206\u7C7B"},{default:a(()=>[(u(!0),_(b,null,k(n.categories,(i,T)=>(u(),A(C,{key:T,label:i,value:i},null,8,["label","value"]))),128)),s("div",te,[l(h,{modelValue:r.newCategory,"onUpdate:modelValue":e[1]||(e[1]=i=>r.newCategory=i),placeholder:"\u65B0\u5EFA\u5206\u7C7B",type:"text",onKeyup:I(t.addCategory,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:1}),l(m,{span:7},{default:a(()=>[l(g,{prop:"tag"},{default:a(()=>[l(d,{modelValue:t.article.tag,"onUpdate:modelValue":e[4]||(e[4]=i=>t.article.tag=i),placeholder:"\u9009\u62E9\u6807\u7B7E","collapse-tags":"",multiple:!0,clearable:""},{default:a(()=>[(u(!0),_(b,null,k(n.tags,(i,T)=>(u(),A(C,{key:T,label:i,value:i},null,8,["label","value"]))),128)),s("div",le,[l(h,{modelValue:r.newTag,"onUpdate:modelValue":e[3]||(e[3]=i=>r.newTag=i),placeholder:"\u65B0\u5EFA\u6807\u7B7E",type:"text",onKeyup:I(t.addTag,["enter"])},null,8,["modelValue","onKeyup"])])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:1}),l(m,{span:8},{default:a(()=>[l(V,{ref:"uploadRef",class:"upload-demo",name:"illustrate",accept:".png, .jpg","http-request":t.uploadHandler,limit:1},{trigger:a(()=>[l(c,{type:"primary"},{default:a(()=>[p("\u9009\u62E9\u63D2\u56FE")]),_:1})]),_:1},8,["http-request"])]),_:1})]),_:1})])]),_:1}),l(m,{span:1}),l(m,{span:6},{default:a(()=>[l(K,{name:"el-zoom-in-top"},{default:a(()=>[s("div",ae,[s("img",{src:t.article.img,onerror:"javascript:this.src='src/img/imgslot.webp'"},null,8,se)])]),_:1})]),_:1}),l(m,{span:4},{default:a(()=>[s("div",null,[l(c,{type:"primary",onClick:t.saveToScript},{default:a(()=>[p("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"])]),s("div",oe,[l(c,{type:"primary",onClick:t.saveAndIssue},{default:a(()=>[p("\u53D1\u8868")]),_:1},8,["onClick"])]),s("div",ie,[l(c,{type:"danger",onClick:t.closeAndSaveToScript},{default:a(()=>[p("\u5173\u95ED")]),_:1},8,["onClick"])])]),_:1})]),_:1})]),s("div",ne,[s("div",re,[l(h,{style:{"font-size":"16px",height:"100%"},type:"textarea",modelValue:t.article.content,"onUpdate:modelValue":e[5]||(e[5]=i=>t.article.content=i),resize:"none",placeholder:"\u6587\u7AE0\u5185\u5BB9"},null,8,["modelValue"])]),s("div",{class:"resize",onMousedown:e[6]||(e[6]=(...i)=>t.drapContent&&t.drapContent(...i)),onDblclick:e[7]||(e[7]=(...i)=>t.resetSize&&t.resetSize(...i))},null,32),s("div",{class:"markdown-body",innerHTML:t.htmlContent},null,8,de)])]),_:1},8,["model","rules"]),l(c,{type:"primary",onClick:t.saveToScript},{default:a(()=>[p("\u4FDD\u5B58\u5230\u8349\u7A3F")]),_:1},8,["onClick"]),l(c,{type:"primary",onClick:t.saveAndIssue},{default:a(()=>[p("\u53D1\u8868")]),_:1},8,["onClick"]),l(c,{type:"danger",onClick:t.closeAndSaveToScript},{default:a(()=>[p("\u5173\u95ED")]),_:1},8,["onClick"]),l(c,{type:"danger",onClick:t.test},{default:a(()=>[p("test")]),_:1},8,["onClick"]),l(U)]),_:1},8,["modelValue","onClose"])}const ue=S(Y,[["render",ce],["__scopeId","data-v-67a7463b"]]);const pe={components:{ArticleEditorVue:ue},props:{},data(){return{query:"",articleList:[],queryData:{authorId:"",startPage:0,pageSize:10},categories:[],tags:[]}},methods:{queryHandler(){},addHandler(){this.$store.commit("clearArticle"),this.editDialog=!0},editHandler(o){let e={ArticleId:o};f.get("init/getArticle",e).then(n=>{n.code==200&&(this.$store.commit("setArticle",n.data),setTimeout(()=>{this.editDialog=!0},100))})},deleteHandler(o){},articleDeail(o){this.$router.push({path:"ArticleDetail/"+o})}},computed:{editDialog:{get(){return this.$store.state.editDialog},set(o){this.$store.state.editDialog=o}},isLogin:{set(o){this.$store.state.isLogin=o},get(){return this.$store.state.isLogin}},authorId(){return this.$store.isLogin?this.$store.state.authorId:this.$store.state.defaultAuthorId}},watch:{},mounted(){this.queryData.authorId=this.authorId,f.get("init/getArticleList",this.queryData).then(e=>{e.data.forEach(n=>{n.tag=JSON.parse(n.tag).tags,n.digest=n.digest.replace(/#*.*#/g,"").replace(/[^a-z0-9\u4e00-\u9fa5]/,"").substring(0,200),this.articleList.push(n)})});let o={authorId:this.authorId};f.get("init/tags/",o).then(e=>{this.tags=e.data}),f.get("init/category/",o).then(e=>{this.categories=e.data})}},x=o=>(X("data-v-34078cb7"),o=o(),O(),o),ge={class:"body"},me={style:{display:"flex","justify-content":"space-between"}},_e={style:{width:"200px",display:"inline-block",opacity:"0.5"}},he={style:{"margin-left":"20px",display:"inline-block",opacity:"0.5"}},ye={key:0,style:{"margin-left":"20px",opacity:"0.7"}},fe=["data-index"],ve={class:"content"},Ce=["onClick"],we=x(()=>s("span",null," \u65F6\u95F4:",-1)),ke={style:{color:"#d63a3a","font-size":"90%"}},be=x(()=>s("span",null," \u5206\u7C7B:",-1)),xe={style:{color:"#d63a3a","font-size":"90%"}},Ve=x(()=>s("span",null," \u6807\u7B7E:",-1)),Te=x(()=>s("span",{style:{color:"#00c6a5"}},null,-1)),Ae={style:{margin:"10px 0","text-indent":"2em","line-height":"20px"}},Ee={class:"but"},De={key:0,class:"buttom"},Ie={key:1,class:"buttom"};function Se(o,e,n,y,r,t){const h=H,g=L,C=z("ArticleEditorVue");return u(),_("div",ge,[s("div",me,[s("div",null,[s("div",_e,[l(h,{modelValue:r.query,"onUpdate:modelValue":e[0]||(e[0]=d=>r.query=d)},null,8,["modelValue"])]),s("div",he,[l(g,{color:"#626aef",onClick:t.queryHandler},{default:a(()=>[p("\u67E5\u627E")]),_:1},8,["onClick"])])]),t.isLogin?(u(),_("div",ye,[l(g,{color:"#ffae19",onClick:t.addHandler},{default:a(()=>[p("\u5199\u6587\u7AE0")]),_:1},8,["onClick"])])):E("",!0)]),(u(!0),_(b,null,k(r.articleList,(d,m)=>(u(),_("div",{key:d.id,"data-index":m,class:"article"},[s("div",ve,[s("div",null,[s("span",{class:"title",onClick:c=>t.articleDeail(d.id)},v(d.title)+" \xA0",9,Ce),we,s("span",ke,v(d.createTime)+" \xA0",1),be,s("span",xe,v(d.category)+" \xA0",1),Ve,(u(!0),_(b,null,k(d.tag,(c,V)=>(u(),_("span",{style:{color:"#d63a3a","font-size":"90%"},key:V},[p(v(c)+" ",1),Te]))),128))]),s("div",Ae,v(d.digest),1)]),s("div",Ee,[t.isLogin?(u(),_("div",De,[l(g,{type:"primary",onClick:c=>t.editHandler(d.id)},{default:a(()=>[p("\u7F16\u8F91")]),_:2},1032,["onClick"])])):E("",!0),t.isLogin?(u(),_("div",Ie,[l(g,{type:"danger",onClick:c=>t.deleteHandler(d.id)},{default:a(()=>[p("\u5220\u9664")]),_:2},1032,["onClick"])])):E("",!0)])],8,fe))),128)),l(C,{categories:r.categories,tags:r.tags},null,8,["categories","tags"])])}const Ue=S(pe,[["render",Se],["__scopeId","data-v-34078cb7"]]);export{Ue as default};
